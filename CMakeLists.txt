cmake_minimum_required (VERSION 3.10) 
project ("SnapDetect") #å·¥ç¨‹å

#C++ç‰ˆæœ¬çš„æ ‡å‡†
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# æ·»åŠ UTF-8ç¼–ç æ”¯æŒ
add_compile_options("/utf-8")

# ========== å›ºå®šè¾“å‡ºç›®å½•ï¼ˆé€‚é…VSCode CMake Toolsï¼‰ ==========
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE "${CMAKE_SOURCE_DIR}/build/Release")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG "${CMAKE_SOURCE_DIR}/build/Debug")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELEASE "${CMAKE_SOURCE_DIR}/build/Release/lib")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_DEBUG "${CMAKE_SOURCE_DIR}/build/Debug/lib")

# è‡ªå®šä¹‰ç¼–è¯‘çš„OpenCVæ ¹ç›®å½•
set(MY_OPENCV_DIR "D:/opencv-4.8.0")
set(OpenCV_DIR "${MY_OPENCV_DIR}/build")
find_package(OpenCV REQUIRED 
    COMPONENTS core imgcodecs imgproc highgui videoio
)

# ========== ä¼˜åŒ–ï¼šè¡¥å…¨æ„å»ºæ¨¡å¼æç¤º ==========
if(CMAKE_BUILD_TYPE)
    message(STATUS "å½“å‰æ„å»ºæ¨¡å¼: ${CMAKE_BUILD_TYPE} (ç”±CMake Toolsæ§åˆ¶)")
else()
    message(STATUS "å½“å‰æ„å»ºæ¨¡å¼: é…ç½®é˜¶æ®µæœªæŒ‡å®šï¼ˆæ„å»ºæ—¶ç”±CMake Toolsé€‰æ‹©Release/Debugï¼‰")
endif()
message(STATUS "OpenCV_LIBS: ${OpenCV_LIBS}")
message(STATUS "å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºç›®å½•(Release): ${CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE}")
message(STATUS "å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºç›®å½•(Debug): ${CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG}")

include_directories(${CMAKE_SOURCE_DIR}/include) 
include_directories(${OpenCV_INCLUDE_DIRS})

#è‡ªåŠ¨æ·»åŠ æ‰€æœ‰æºæ–‡ä»¶
file(GLOB SRC_FILES "source/*.cpp")

# ========== åˆ›å»ºç›®æ ‡ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰ ==========
add_executable(${PROJECT_NAME} main.cpp ${SRC_FILES})
target_link_libraries(${PROJECT_NAME} PRIVATE ${OpenCV_LIBS})

add_library(${PROJECT_NAME}Lib SHARED ${SRC_FILES})
target_link_libraries(${PROJECT_NAME}Lib PRIVATE ${OpenCV_LIBS})

# ========== é…ç½®æ—¶å¤åˆ¶Release DLLï¼ˆå¤±è´¥ä»…è­¦å‘Šï¼‰ ==========
set(OPENCV_DLL_RELEASE
    "${MY_OPENCV_DIR}/build/bin/Release/opencv_core480.dll"
    "${MY_OPENCV_DIR}/build/bin/Release/opencv_imgcodecs480.dll"
    "${MY_OPENCV_DIR}/build/bin/Release/opencv_imgproc480.dll"
    "${MY_OPENCV_DIR}/build/bin/Release/opencv_highgui480.dll"
    "${MY_OPENCV_DIR}/build/bin/Release/opencv_videoio480.dll"
)

foreach(dll ${OPENCV_DLL_RELEASE})
    if(EXISTS ${dll})
        file(COPY ${dll} DESTINATION ${CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE})
        message(STATUS "âœ… å·²å¤åˆ¶Release DLL: ${dll}")
    else()
        message(WARNING "âš ï¸ æœªæ‰¾åˆ°Release DLL: ${dll}ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶åˆ° ${CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE}")
    endif()
endforeach()

# é“¾æ¥åº“è·¯å¾„
link_directories("${MY_OPENCV_DIR}/build/lib/Release")
link_directories("${MY_OPENCV_DIR}/build/lib/Debug")

# æœ€ç»ˆæç¤º
message(STATUS "======================================")
message(STATUS "ğŸ“Œ ç¼–è¯‘å®Œæˆåæ“ä½œæç¤ºï¼š")
message(STATUS "   1. å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼šbuild/Release/SnapDetect.exe")
message(STATUS "   2. è‹¥è¿è¡Œæç¤ºç¼ºDLLï¼Œæ‰‹åŠ¨å¤åˆ¶OpenCVçš„Release DLLåˆ°ä¸Šè¿°ç›®å½•")
message(STATUS "   3. Debugæ¨¡å¼åŒç†ï¼Œå¤åˆ¶Debugç‰ˆDLLåˆ° build/Debug")
message(STATUS "======================================")